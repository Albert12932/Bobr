definitions:
  models.Auth:
    properties:
      access_token:
        type: string
      expires_at:
        type: integer
      refresh_token:
        type: string
    type: object
  models.AuthBookRequest:
    properties:
      book_id:
        type: integer
    type: object
  models.AuthStatus:
    properties:
      display_name:
        type: string
      group:
        type: string
      link_token:
        type: string
      link_token_ttl_sec:
        type: integer
      status:
        type: string
    type: object
  models.CompleteUserEventRequest:
    properties:
      event_id:
        type: integer
      user_id:
        type: integer
    type: object
  models.CompletedEvent:
    properties:
      completed_at:
        type: string
      event_id:
        type: integer
      user_id:
        type: integer
    type: object
  models.CreateEventRequest:
    properties:
      description:
        type: string
      event_date:
        type: string
      event_type_code:
        type: integer
      icon_url:
        type: string
      points:
        type: integer
      title:
        type: string
    required:
    - title
    type: object
  models.CreateEventResponse:
    properties:
      created:
        type: string
      description:
        type: string
      event_date:
        type: string
      event_id:
        type: integer
      event_type_code:
        type: integer
      icon_url:
        type: string
      points:
        type: integer
      title:
        type: string
    type: object
  models.DeleteCompletedEventResponse:
    properties:
      event_id:
        type: integer
      successful:
        type: boolean
      user_id:
        type: integer
    type: object
  models.DeleteEventResponse:
    properties:
      event_id:
        type: integer
      successful:
        type: boolean
    type: object
  models.DeleteUserResponse:
    properties:
      email:
        type: string
      successful:
        type: boolean
    type: object
  models.ErrorResponse:
    properties:
      error:
        type: string
      message:
        type: string
    type: object
  models.Event:
    properties:
      created:
        type: string
      description:
        type: string
      event_date:
        type: string
      event_id:
        type: integer
      event_type_code:
        type: integer
      icon_url:
        type: string
      points:
        type: integer
      title:
        type: string
    type: object
  models.LoginRequest:
    properties:
      email:
        type: string
      password:
        type: string
    required:
    - email
    - password
    type: object
  models.LoginResponse:
    properties:
      auth:
        $ref: '#/definitions/models.Auth'
      user:
        $ref: '#/definitions/models.UserSubstructure'
    type: object
  models.ProfileResponse:
    properties:
      birthDate:
        type: string
      bookId:
        format: int64
        type: integer
      email:
        type: string
      middleName:
        type: string
      name:
        type: string
      roleLevel:
        format: int64
        type: integer
      studentGroup:
        type: string
      surname:
        type: string
    type: object
  models.RefreshTokenRequest:
    properties:
      refresh_token:
        type: string
    type: object
  models.RefreshTokenResponse:
    properties:
      auth:
        $ref: '#/definitions/models.Auth'
      user_id:
        type: integer
    type: object
  models.RegisterRequest:
    properties:
      email:
        type: string
      password:
        type: string
      token:
        type: string
    required:
    - token
    type: object
  models.RegisterResponse:
    properties:
      auth:
        $ref: '#/definitions/models.Auth'
      user:
        $ref: '#/definitions/models.UserSubstructure'
    type: object
  models.ResetPasswordRequest:
    properties:
      email:
        type: string
    required:
    - email
    type: object
  models.SetNewPasswordRequest:
    properties:
      new_password:
        type: string
      token:
        type: string
    required:
    - new_password
    - token
    type: object
  models.Student:
    properties:
      birth_date:
        type: string
      book_id:
        type: integer
      group:
        type: string
      id:
        type: integer
      middle_name:
        type: string
      name:
        type: string
      surname:
        type: string
    type: object
  models.SuccessResponse:
    properties:
      message:
        type: string
      successful:
        type: boolean
    type: object
  models.UpdateEventRequest:
    properties:
      event_id:
        type: integer
      new_data:
        properties:
          description:
            type: string
          event_date:
            type: string
          event_type_code:
            type: integer
          icon_url:
            type: string
          points:
            type: integer
          title:
            type: string
        type: object
    type: object
  models.UpdateUserRequest:
    properties:
      new_data:
        properties:
          book_id:
            type: integer
          email:
            example: ""
            type: string
          middle_name:
            example: ""
            type: string
          name:
            example: ""
            type: string
          role_level:
            type: integer
          student_group:
            example: ""
            type: string
          surname:
            example: ""
            type: string
        type: object
      user_id:
        type: integer
    type: object
  models.UpdateUserResponse:
    properties:
      new:
        properties:
          book_id:
            type: integer
          email:
            example: ""
            type: string
          middle_name:
            example: ""
            type: string
          name:
            example: ""
            type: string
          role_level:
            type: integer
          student_group:
            example: ""
            type: string
          surname:
            example: ""
            type: string
        type: object
      successful:
        type: boolean
      user_id:
        type: integer
    type: object
  models.User:
    properties:
      birth_date:
        type: string
      book_id:
        type: integer
      email:
        type: string
      id:
        type: integer
      middle_name:
        type: string
      name:
        type: string
      password:
        items:
          type: integer
        type: array
      role_level:
        type: integer
      student_group:
        type: string
      surname:
        type: string
    type: object
  models.UserCompletedEvent:
    properties:
      completed_at:
        type: string
      event_id:
        type: integer
    type: object
  models.UserSubstructure:
    properties:
      book_id:
        type: integer
      email:
        type: string
      first_name:
        type: string
      id:
        type: integer
      role_level:
        type: integer
      student_group:
        type: string
    type: object
info:
  contact: {}
paths:
  /admin/add_completed_event:
    post:
      consumes:
      - application/json
      description: Добавляет запись о выполнении события конкретным пользователем.
        Требует прав администратора.
      parameters:
      - description: 'Bearer токен авторизации. Формат: Bearer {token}'
        in: header
        name: Authorization
        required: true
        type: string
      - description: ID пользователя и ID события
        in: body
        name: input
        required: true
        schema:
          $ref: '#/definitions/models.CompleteUserEventRequest'
      produces:
      - application/json
      responses:
        "200":
          description: Событие отмечено как выполненное
          schema:
            $ref: '#/definitions/models.SuccessResponse'
        "400":
          description: Некорректные данные или пользователь/событие не существуют
          schema:
            $ref: '#/definitions/models.ErrorResponse'
        "401":
          description: Нет прав доступа
          schema:
            $ref: '#/definitions/models.ErrorResponse'
        "409":
          description: Событие уже было отмечено ранее
          schema:
            $ref: '#/definitions/models.ErrorResponse'
        "500":
          description: Ошибка сервера при добавлении записи
          schema:
            $ref: '#/definitions/models.ErrorResponse'
      summary: Отметить выполнение события
      tags:
      - admin
  /admin/completed_events:
    get:
      consumes:
      - application/json
      description: Возвращает полный список выполненных событий всех пользователей
        системы.
      parameters:
      - description: 'Bearer токен авторизации. Формат: Bearer {token}'
        in: header
        name: Authorization
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: Список выполненных событий всех пользователей
          schema:
            items:
              $ref: '#/definitions/models.CompletedEvent'
            type: array
        "401":
          description: Нет прав доступа
          schema:
            $ref: '#/definitions/models.ErrorResponse'
        "500":
          description: Ошибка сервера при получении выполненных событий
          schema:
            $ref: '#/definitions/models.ErrorResponse'
      summary: Получить все выполненные события
      tags:
      - admin
  /admin/create_event:
    post:
      consumes:
      - application/json
      description: Создаёт новое событие в системе и возвращает полную информацию
        о созданной записи. Требует авторизации администратора. Поля помимо title
        могут не указываться, тогда они будут заменены на стандартные значения
      parameters:
      - description: 'Bearer токен авторизации. Формат: Bearer {token}'
        in: header
        name: Authorization
        required: true
        type: string
      - description: Данные нового события
        in: body
        name: input
        required: true
        schema:
          $ref: '#/definitions/models.CreateEventRequest'
      produces:
      - application/json
      responses:
        "200":
          description: Событие успешно создано
          schema:
            $ref: '#/definitions/models.CreateEventResponse'
        "400":
          description: Некорректный JSON или ошибка валидации
          schema:
            $ref: '#/definitions/models.ErrorResponse'
        "401":
          description: Нет доступа — невалидный или отсутствующий токен
          schema:
            $ref: '#/definitions/models.ErrorResponse'
        "500":
          description: Ошибка сервера при создании события
          schema:
            $ref: '#/definitions/models.ErrorResponse'
      summary: Создать событие
      tags:
      - admin
  /admin/delete_completed_event/{user_id}/{event_id}:
    delete:
      consumes:
      - application/json
      description: Удаляет отметку о выполнении события конкретным пользователем.
        Требует прав администратора.
      parameters:
      - description: 'Bearer токен авторизации. Формат: Bearer {token}'
        in: header
        name: Authorization
        required: true
        type: string
      - description: ID пользователя
        in: path
        name: user_id
        required: true
        type: integer
      - description: ID события
        in: path
        name: event_id
        required: true
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: Отметка о выполнении успешно удалена
          schema:
            $ref: '#/definitions/models.DeleteCompletedEventResponse'
        "400":
          description: Некорректный user_id или event_id
          schema:
            $ref: '#/definitions/models.ErrorResponse'
        "401":
          description: Нет прав доступа
          schema:
            $ref: '#/definitions/models.ErrorResponse'
        "404":
          description: Отметка о выполнении не найдена
          schema:
            $ref: '#/definitions/models.ErrorResponse'
        "500":
          description: Ошибка сервера при удалении
          schema:
            $ref: '#/definitions/models.ErrorResponse'
      summary: Удаление выполнения события
      tags:
      - admin
  /admin/delete_event/{id}:
    delete:
      consumes:
      - application/json
      description: Удаляет событие по его идентификатору. Требует прав администратора.
      parameters:
      - description: 'Bearer токен авторизации. Формат: Bearer {token}'
        in: header
        name: Authorization
        required: true
        type: string
      - description: ID события для удаления
        in: path
        name: id
        required: true
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: Событие успешно удалено
          schema:
            $ref: '#/definitions/models.DeleteEventResponse'
        "400":
          description: Некорректный ID события
          schema:
            $ref: '#/definitions/models.ErrorResponse'
        "401":
          description: Нет прав доступа
          schema:
            $ref: '#/definitions/models.ErrorResponse'
        "404":
          description: Событие с указанным ID не найдено
          schema:
            $ref: '#/definitions/models.ErrorResponse'
        "500":
          description: Ошибка сервера при удалении
          schema:
            $ref: '#/definitions/models.ErrorResponse'
      summary: Удалить событие
      tags:
      - admin
  /admin/delete_user/{email}:
    delete:
      consumes:
      - application/json
      description: Удаляет пользователя по его email. Требует прав администратора.
      parameters:
      - description: 'Bearer токен авторизации. Формат: Bearer {token}'
        in: header
        name: Authorization
        required: true
        type: string
      - description: Email удаляемого пользователя
        in: path
        name: email
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: Пользователь успешно удалён
          schema:
            $ref: '#/definitions/models.DeleteUserResponse'
        "400":
          description: Передан пустой email
          schema:
            $ref: '#/definitions/models.ErrorResponse'
        "401":
          description: Нет прав доступа к операции
          schema:
            $ref: '#/definitions/models.ErrorResponse'
        "404":
          description: Пользователь с таким email не найден
          schema:
            $ref: '#/definitions/models.ErrorResponse'
        "500":
          description: Ошибка сервера при удалении
          schema:
            $ref: '#/definitions/models.ErrorResponse'
      summary: Удалить пользователя
      tags:
      - admin
  /admin/events:
    get:
      consumes:
      - application/json
      description: Возвращает полный список событий из базы данных.
      parameters:
      - description: 'Bearer токен авторизации. Формат: Bearer {token}'
        in: header
        name: Authorization
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: Список событий
          schema:
            items:
              $ref: '#/definitions/models.Event'
            type: array
        "500":
          description: Ошибка сервера при получении списка событий
          schema:
            $ref: '#/definitions/models.ErrorResponse'
      summary: Получить все события
      tags:
      - admin
  /admin/students:
    get:
      description: Возвращает всех студентов из таблицы students.
      parameters:
      - default: Bearer
        description: Bearer токен
        in: header
        name: Authorization
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: Список студентов
          schema:
            items:
              $ref: '#/definitions/models.Student'
            type: array
        "500":
          description: Ошибка при запросе или чтении данных
          schema:
            $ref: '#/definitions/models.ErrorResponse'
      security:
      - BearerAuth: []
      summary: Получение списка студентов
      tags:
      - admin
  /admin/update_event:
    patch:
      consumes:
      - application/json
      description: |-
        Производит частичное обновление данных события по его ID.
        Обновляются только те поля, которые переданы в теле запроса.
      parameters:
      - description: 'Bearer токен авторизации. Формат: Bearer {token}'
        in: header
        name: Authorization
        required: true
        type: string
      - description: ID события и новые значения полей
        in: body
        name: input
        required: true
        schema:
          $ref: '#/definitions/models.UpdateEventRequest'
      produces:
      - application/json
      responses:
        "200":
          description: Событие успешно обновлено
          schema:
            $ref: '#/definitions/models.SuccessResponse'
        "400":
          description: Некорректный JSON или ошибка валидации
          schema:
            $ref: '#/definitions/models.ErrorResponse'
        "401":
          description: Неавторизованный доступ — неверный или отсутствующий токен
          schema:
            $ref: '#/definitions/models.ErrorResponse'
        "500":
          description: Ошибка сервера при попытке обновления записи
          schema:
            $ref: '#/definitions/models.ErrorResponse'
      summary: Обновить выбранные поля события
      tags:
      - admin
  /admin/update_user:
    patch:
      consumes:
      - application/json
      description: Обновляет данные пользователя с проверкой прав доступа. Только
        пользователи с более высоким уровнем прав могут изменять данные пользователей
        с более низким уровнем прав.
      parameters:
      - default: Bearer
        description: 'Bearer токен в формате: Bearer {token} default(Bearer )'
        in: header
        name: Authorization
        required: true
        type: string
      - description: Данные для обновления пользователя
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/models.UpdateUserRequest'
      produces:
      - application/json
      responses:
        "200":
          description: Успешное обновление данных пользователя
          schema:
            $ref: '#/definitions/models.UpdateUserResponse'
        "400":
          description: Ошибка в формате JSON
          schema:
            $ref: '#/definitions/models.ErrorResponse'
        "403":
          description: Недостаточно прав
          schema:
            $ref: '#/definitions/models.ErrorResponse'
        "500":
          description: Внутренняя ошибка сервера
          schema:
            $ref: '#/definitions/models.ErrorResponse'
      summary: Обновление данных пользователя
      tags:
      - admin
  /admin/users:
    get:
      description: Возвращает всех зарегистрированных пользователей из таблицы users.
      parameters:
      - default: Bearer
        description: Bearer токен
        in: header
        name: Authorization
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: Список пользователей
          schema:
            items:
              $ref: '#/definitions/models.User'
            type: array
        "500":
          description: Ошибка при запросе или чтении данных
          schema:
            $ref: '#/definitions/models.ErrorResponse'
      security:
      - BearerAuth: []
      summary: Получение списка пользователей
      tags:
      - admin
  /auth/check:
    post:
      consumes:
      - application/json
      description: |-
        Проверяет наличие студенческого билета в системе.
        Если студент не зарегистрирован, генерирует временный токен для регистрации.
      parameters:
      - description: Номер студенческого билета
        in: body
        name: input
        required: true
        schema:
          $ref: '#/definitions/models.AuthBookRequest'
      produces:
      - application/json
      responses:
        "200":
          description: Студенческий найден, выдан регистрационный токен" example({"status":"free","display_name":"Иван","group":"ШАД-111",
            "LinkToken":"raw_token_string","LinkTokenTtlSec":300})
          schema:
            $ref: '#/definitions/models.AuthStatus'
        "400":
          description: Некорректный запрос — ошибка парсинга JSON
          schema:
            $ref: '#/definitions/models.ErrorResponse'
        "404":
          description: Студенческий не найден в базе
          schema:
            $ref: '#/definitions/models.ErrorResponse'
        "409":
          description: Пользователь с таким номером уже зарегистрирован
          schema:
            $ref: '#/definitions/models.ErrorResponse'
        "500":
          description: Ошибка при генерации или сохранении токена
          schema:
            $ref: '#/definitions/models.ErrorResponse'
      summary: Проверка студенческого в системе
      tags:
      - auth
  /auth/login:
    post:
      consumes:
      - application/json
      description: |-
        Проверяет почту и пароль пользователя.
        При успешной авторизации выдает пару access и refresh токенов.
      parameters:
      - description: Данные для входа (почта и пароль)
        in: body
        name: input
        required: true
        schema:
          $ref: '#/definitions/models.LoginRequest'
      produces:
      - application/json
      responses:
        "200":
          description: Успешная авторизация — возвращается пользователь и пара токенов"
            example({"user":{"id":1,"first_name":"Иван","surname":"Иванов"},"session":{"auth":{"access_token":"token
            string", "refresh_token":"token string","expires_at":"2024-01-01T00:00:00Z"}}})
          schema:
            $ref: '#/definitions/models.LoginResponse'
        "400":
          description: Некорректный запрос — ошибка парсинга JSON
          schema:
            $ref: '#/definitions/models.ErrorResponse'
        "401":
          description: Неверная почта или пароль
          schema:
            $ref: '#/definitions/models.ErrorResponse'
        "404":
          description: Пользователь с такой почтой не найден
          schema:
            $ref: '#/definitions/models.ErrorResponse'
        "500":
          description: Ошибка сервера при работе с базой данных или токенами
          schema:
            $ref: '#/definitions/models.ErrorResponse'
      summary: Авторизация пользователя
      tags:
      - auth
  /auth/refresh:
    post:
      consumes:
      - application/json
      description: Принимает refresh токен, проверяет его валидность и возвращает
        новую пару токенов.
      parameters:
      - description: Refresh токен
        in: body
        name: input
        required: true
        schema:
          $ref: '#/definitions/models.RefreshTokenRequest'
      produces:
      - application/json
      responses:
        "200":
          description: Успешное обновление токенов
          schema:
            $ref: '#/definitions/models.RefreshTokenResponse'
        "400":
          description: Некорректный JSON
          schema:
            $ref: '#/definitions/models.ErrorResponse'
        "401":
          description: Невалидный или просроченный refresh токен
          schema:
            $ref: '#/definitions/models.ErrorResponse'
        "500":
          description: Ошибка при обновлении/генерации токенов
          schema:
            $ref: '#/definitions/models.ErrorResponse'
      summary: Обновление access и refresh токенов
      tags:
      - auth
  /auth/register:
    post:
      consumes:
      - application/json
      description: Регистрирует нового пользователя на основе временного токена, выданного
        после проверки студенческого билета.
      parameters:
      - description: Почта, пароль и токен регистрации пользователя
        in: body
        name: input
        required: true
        schema:
          $ref: '#/definitions/models.RegisterRequest'
      produces:
      - application/json
      responses:
        "200":
          description: Успешная регистрация
          schema:
            $ref: '#/definitions/models.RegisterResponse'
        "400":
          description: Некорректный запрос или формат данных
          schema:
            $ref: '#/definitions/models.ErrorResponse'
        "401":
          description: Токен не найден или истёк
          schema:
            $ref: '#/definitions/models.ErrorResponse'
        "404":
          description: Студент с такой почтой не найден
          schema:
            $ref: '#/definitions/models.ErrorResponse'
        "409":
          description: Пользователь с такой почтой уже существует
          schema:
            $ref: '#/definitions/models.ErrorResponse'
        "500":
          description: Ошибка сервера (база данных, хеширование, транзакция)
          schema:
            $ref: '#/definitions/models.ErrorResponse'
      summary: Регистрация пользователя по токену
      tags:
      - auth
  /auth/reset_password:
    post:
      consumes:
      - application/json
      description: |-
        Отправляет на почту пользователя ссылку для сброса пароля.
        Если пользователь с указанной почтой существует — ему придёт письмо с временной ссылкой на установку нового пароля.
      parameters:
      - description: Почта пользователя
        in: body
        name: input
        required: true
        schema:
          $ref: '#/definitions/models.ResetPasswordRequest'
      produces:
      - application/json
      responses:
        "200":
          description: Инструкция отправлена на почту
          schema:
            additionalProperties:
              type: string
            type: object
        "400":
          description: Некорректный JSON
          schema:
            $ref: '#/definitions/models.ErrorResponse'
        "500":
          description: Ошибка при поиске пользователя или отправке письма
          schema:
            $ref: '#/definitions/models.ErrorResponse'
      summary: Запрос на сброс пароля
      tags:
      - auth
  /auth/set_new_password:
    post:
      consumes:
      - application/json
      description: Устанавливает новый пароль по токену из письма. Токен действителен
        ограниченное время (15 минут).
      parameters:
      - description: Токен и новый пароль
        in: body
        name: input
        required: true
        schema:
          $ref: '#/definitions/models.SetNewPasswordRequest'
      produces:
      - application/json
      responses:
        "200":
          description: Пароль успешно обновлён
          schema:
            $ref: '#/definitions/models.SuccessResponse'
        "400":
          description: Некорректный JSON
          schema:
            $ref: '#/definitions/models.ErrorResponse'
        "401":
          description: Невалидный или истекший токен
          schema:
            $ref: '#/definitions/models.ErrorResponse'
        "500":
          description: Ошибка при обновлении пароля
          schema:
            $ref: '#/definitions/models.ErrorResponse'
      summary: Установка нового пароля
      tags:
      - auth
  /me/completed_events:
    get:
      consumes:
      - application/json
      description: Возвращает список событий, которые пользователь отметил как выполненные.
      parameters:
      - description: 'Bearer токен авторизации. Формат: Bearer {token}'
        in: header
        name: Authorization
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: Список выполненных пользователем событий
          schema:
            items:
              $ref: '#/definitions/models.UserCompletedEvent'
            type: array
        "400":
          description: Некорректный user_id
          schema:
            $ref: '#/definitions/models.ErrorResponse'
        "401":
          description: Нет доступа
          schema:
            $ref: '#/definitions/models.ErrorResponse'
        "500":
          description: Ошибка сервера при получении выполненных событий
          schema:
            $ref: '#/definitions/models.ErrorResponse'
      summary: Получить выполненные события
      tags:
      - user
  /me/profile:
    get:
      description: Возвращает данные о пользователе
      parameters:
      - default: Bearer
        description: Bearer токен
        in: header
        name: Authorization
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: Данные о пользователе
          schema:
            $ref: '#/definitions/models.ProfileResponse'
        "500":
          description: Ошибка при запросе или чтении данных
          schema:
            $ref: '#/definitions/models.ErrorResponse'
      security:
      - BearerAuth: []
      summary: Получение профиля пользователя
      tags:
      - user
swagger: "2.0"
